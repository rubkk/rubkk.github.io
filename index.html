<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPBãƒ¯ãƒ¼ãƒ‰ã‚¦ãƒ«ãƒ•</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'M PLUS Rounded 1c', sans-serif; 
            text-align: center; 
            padding: 50px; 
            background: linear-gradient(to bottom, #f0f8ff, #e0f7fa); 
            font-size: 20px; 
            color: #333;
            position: relative;
            min-height: 100vh;
            padding-bottom: 150px; /* ãƒœã‚¿ãƒ³åˆ†ã®ä½™ç™½ã‚’ç¢ºä¿ */
        }
        h1 { font-size: 48px; margin-bottom: 30px; }
        input, button, select { 
            padding: 15px; 
            margin: 15px; 
            font-size: 22px; 
            border-radius: 10px; 
            border: 2px solid #aaa;
            background: white;
        }
        #setup { 
            margin: 40px auto; 
            max-width: 600px; 
            background: #fff; 
            padding: 40px; 
            border-radius: 20px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.1); 
        }
        #timer { 
            font-size: 52px; 
            margin: 60px; 
            position: relative; 
            z-index: 101; /* æ™‚è¨ˆã‚’æœ€å‰é¢ã«ï¼ */
            background: rgba(255,255,255,0.8); 
            padding: 10px 20px; 
            border-radius: 15px; 
        }
        #discussionTimer { font-size: 90px; margin: 50px; text-shadow: 4px 4px 10px #aaa; }
        #result { 
            font-size: 28px; 
            margin: 60px auto; 
            max-width: 800px; 
            padding: 40px; 
            background: white; 
            border: 5px dashed #888; 
            border-radius: 25px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); 
        }
        .hidden { display: none !important; }
        #guide { 
            font-size: 26px; 
            margin: 40px; 
            font-weight: bold; 
            color: #444; 
            position: relative; 
            z-index: 1; 
        }
        #voteSection, #resultSection { 
            font-size: 24px; 
            margin: 40px auto; 
            max-width: 600px; 
            padding: 30px; 
            background: #e8f4f8; 
            border-radius: 20px; 
            box-shadow: 0 8px 15px rgba(0,0,0,0.1); 
        }
        .win { color: #0a0; font-size: 52px; animation: bounce 1.5s infinite; }
        .lose { color: #c00; font-size: 52px; animation: shake 0.8s; }
        #nextGameBtn { 
            padding: 30px 70px; 
            font-size: 40px; 
            margin: 80px auto; 
            background: linear-gradient(#4CAF50, #388e3c); 
            color: white; 
            border: none; 
            border-radius: 40px; 
            cursor: pointer; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            position: relative;
            z-index: 10;
        }
        #nextGameBtn:hover { transform: scale(1.1); }
        /* ãŠé¡Œã‚’è¦‹ã‚‹ãƒœã‚¿ãƒ³ï¼šã•ã‚‰ã«ä¸‹ã«ç§»å‹•ã—ã¦å°ã•ã */
        #revealBtn {
            padding: 16px 45px;
            font-size: 30px;
            background: linear-gradient(#ff6b6b, #ee5a52);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            position: fixed;
            bottom: 30px; /* ã•ã‚‰ã«ä¸‹ã«ï¼ */
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }
        #revealBtn:hover { 
            transform: translateX(-50%) scale(1.1); 
            background: #ff5252; 
        }
        img.game-img { 
            max-width: 400px; 
            border-radius: 25px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3); 
            margin: 30px auto; 
            display: block; 
        }
        @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-40px); } }
        @keyframes shake { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-20px); } 75% { transform: translateX(20px); } }
    </style>
</head>
<body>
    <h1>ğŸº BPBãƒ¯ãƒ¼ãƒ‰ã‚¦ãƒ«ãƒ• ğŸ‰</h1>

    <div id="setup">
        <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: <input type="number" id="players" value="5" min="3"></p>
        <p>ã‚¦ãƒ«ãƒ•æ•°: <input type="number" id="wolves" value="1" min="1"></p>
        <p>ã‚ãªãŸã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå·: <input type="number" id="myNumber" value="1" min="1"></p>
        <button id="startBtn" onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ ğŸš€</button>
    </div>

    <div id="guide" class="hidden">
        <p>é€²è¡Œå½¹ãŒæ™‚é–“ã‚’æŒ‡å®šã™ã‚‹ã®ã§ã€<br>ãã®æ™‚é–“ã«ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼</p>
        <p><strong>Â±2ç§’ä»¥å†…</strong>ã«æŠ¼ã›ã°å…¨å“¡åŒã˜ãŠé¡Œã«ãªã‚Šã¾ã™</p>
    </div>

    <div id="timer" class="hidden">å¾…æ©Ÿä¸­â€¦</div>

    <button id="revealBtn" class="hidden" onclick="revealWord()">ä»Šï¼ãŠé¡Œã‚’è¦‹ã‚‹ ğŸ”¥</button>

    <div id="result" class="hidden"></div>

    <div id="discussionTimer" class="hidden">3:00</div>

    <div id="voteSection" class="hidden">
        <h2>æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚º</h2>
        <p>èª°ã‚’è¿½æ”¾ç¥¨ã«å…¥ã‚Œã¾ã™ã‹ï¼Ÿ</p>
        <select id="voteTarget"></select>
        <br>
        <button onclick="submitVote()">æŠ•ç¥¨ã™ã‚‹</button>
        <p id="myVote"></p>
    </div>

    <div id="resultSection" class="hidden">
        <h2>çµæœç™ºè¡¨ï¼ˆé€²è¡Œå½¹æ“ä½œï¼‰</h2>
        <p>å£é ­é›†è¨ˆå¾Œã®è¿½æ”¾è€…ç•ªå·ã‚’å…¥åŠ›:</p>
        <input type="number" id="banished" min="1" placeholder="ä¾‹: 3">
        <button onclick="showFinalResult()">çµæœã‚’è¦‹ã‚‹</button>
    </div>

    <button id="nextGameBtn" class="hidden" onclick="nextGame()">æ¬¡ã®ã‚²ãƒ¼ãƒ ã¸ ğŸŠ</button>

    <!-- åŠ¹æœéŸ³ -->
    <audio id="victorySound" src="https://freesound.org/data/previews/466/466133_9033262-lq.mp3"></audio>
    <audio id="loseSound" src="https://freesound.org/data/previews/73/73581_634166-lq.mp3"></audio>
    <audio id="beepSound" src="https://cdn.pixabay.com/download/audio/2022/05/24/audio_8e2e6f7d6d.mp3?filename=beep-6269.mp3"></audio>

    <script>
        const themes = [
            { majority: "ã•ã•ã‚„ããƒ™ãƒ©ãƒ‰ãƒ³ãƒŠã®æ¯’å¼“", minority: "ãƒ™ãƒ©ãƒ‰ãƒ³ãƒŠã®å½±æ¯’å¼“" },
            { majority: "èµ¤ãƒ©ãƒ³ã®é¦–é£¾ã‚Š", minority: "ç™½ãƒ¦ãƒªã®é¦–é£¾ã‚Š" },
            { majority: "ç™½ã®ã‚¯ã‚¤ãƒ¼ãƒ³", minority: "é»’ã®ã‚¯ã‚¤ãƒ¼ãƒ³" },
            { majority: "ã‚³ãƒ¼ãƒ«ãƒ‰ãƒŸãƒ©ãƒ¼", minority: "ã‚¢ã‚¤ã‚¹ãƒ•ãƒ©ãƒ¯ãƒ¼" },
            { majority: "ãƒ¡ã‚¤ã‚¸ã®å¸½å­", minority: "æ†ãŸã‚‰ã—ã„å¸½å­ãƒ»ãƒãƒ­ãƒ«ãƒ‰" },
            { majority: "æ‹›ããƒã‚³", minority: "ãƒã‚³ã®ç²¾éœŠ" },
            { majority: "å¤ä»£ã®çŸ³ï¼šãƒ•ãƒªãƒ¼ã‚º", minority: "å¤ä»£ã®çŸ³ï¼šãƒ•ãƒ¬ã‚¤ãƒ " },
            { majority: "æœ¨ã®å‰£", minority: "ãƒ›ã‚¦ã‚­" },
            { majority: "ãƒ›ã‚¦ã‚­", minority: "ã‚·ãƒ£ãƒ™ãƒ«" },
            { majority: "æœˆã®ç›¾", minority: "æœˆã®é§" },
            { majority: "ãƒ›ã‚¦ã‚­", minority: "ã‚·ãƒ£ãƒ™ãƒ«" },
            { majority: "ãƒã‚ºãƒŸ", minority: "ãƒãƒªãƒã‚ºãƒŸ" },
            { majority: "ãƒŸã‚¹ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒ¥ãƒ³", minority: "ãƒŸã‚»ã‚¹ãƒ»ã‚¹ãƒˆãƒ©ã‚°ãƒ«ã‚º" },
            { majority: "ãƒã‚¤ãƒãƒŠãƒãƒ¼ã‚·ãƒ§ãƒ³", minority: "ãƒãƒŠãƒãƒ¼ã‚·ãƒ§ãƒ³" },
            { majority: "ã‚³ãƒ¼ãƒ«ãƒ‰ãƒŸãƒ©ãƒ¼", minority: "ã‚¢ã‚¤ã‚¹ãƒ•ãƒ©ãƒ¯ãƒ¼" },
            { majority: "ãƒ¡ã‚¤ã‚¸ã®å¸½å­", minority: "æ†ãŸã‚‰ã—ã„å¸½å­ãƒ»ãƒãƒ­ãƒ«ãƒ‰" },
            { majority: "æ‹›ããƒã‚³", minority: "ãƒã‚³ã®ç²¾éœŠ" },
            { majority: "å¤ä»£ã®çŸ³ï¼šãƒ•ãƒªãƒ¼ã‚º", minority: "å¤ä»£ã®çŸ³ï¼šãƒ•ãƒ¬ã‚¤ãƒ " },
            { majority: "ãƒ’ãƒ¼ãƒˆã‚¹ãƒ”ã‚¢", minority: "ãƒ’ãƒ¼ãƒˆãƒ€ã‚¬ãƒ¼" },
            { majority: "ãƒ›ã‚¦ã‚­", minority: "ã‚·ãƒ£ãƒ™ãƒ«" },
            { majority: "å¸¸ç‚", minority: "ã‚½ãƒ©ãƒªã‚¹" },
            { majority: "ãƒ€ãƒ–ãƒ«ã‚¢ãƒƒã‚¯ã‚¹", minority: "ãƒ™ãƒªãƒ¼ãƒ­ãƒ³ã‚°ã‚¹ãƒ”ã‚¢" },
            { majority: "å¯Œã®ãƒ–ã‚¿ã¡ã‚ƒã‚“", minority: "å¹¸é‹ã®ãƒ–ã‚¿ã¡ã‚ƒã‚“" },
            { majority: "ãƒ˜ãƒ“", minority: "ã‚«ãƒ¡" },
            { majority: "ç ´æ»…ã®ã‚°ãƒ¬ãƒ¼ãƒˆã‚½ãƒ¼ãƒ‰", minority: "ã‚ã¾ã‚Šã«ã‚‚å¤§ãã™ãã‚‹ãƒ–ãƒ©ãƒƒãƒ‰ã‚½ãƒ¼ãƒ³" },
            { majority: "ã‚«ã‚¿ãƒŠ", minority: "ãƒã‚§ãƒ¼ãƒ³ã‚¦ã‚£ãƒƒãƒ—" },
            { majority: "ä¾¿åˆ©ãƒãƒ¼ãƒ", minority: "å­¦è€…ã®ã‚«ãƒãƒ³" },
            { majority: "ã‚«ãƒƒãƒ—ã‚±ãƒ¼ã‚­ãƒ»ã‚¹ãƒ©ãƒãƒ¼ãƒˆ", minority: "ãƒ©ã‚¤ãƒˆãƒ»ã‚¹ãƒ©ãƒãƒ¼ãƒˆ" },
            { majority: "æ¥µæ¥½ãƒãƒ¥ãƒ³", minority: "ã‚«ãƒ©ã‚¹" },
            { majority: "ãƒ€ãƒ–ãƒ«ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼", minority: "ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒãƒƒã‚¸" },
            { majority: "ã‚¢ãƒŠã‚°ãƒã®ãƒ«ãƒ¼ãƒ³", minority: "æ­¦å™¨ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆ" },
            { majority: "ãƒ—ãƒ©ãƒãƒŠä¼šå“¡ã‚«ãƒ¼ãƒ‰", minority: "ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ¦ãƒ‹ãƒ¼ã‚¯" },
            { majority: "ã¡ã‚‡ã£ã¨åŠ›ã‚’ï¼", minority: "ã‚‚ã£ã¨åŠ›ã‚’ï¼" },
            { majority: "ã‚­ãƒã‚³è¾²åœ’", minority: "æ·±å €ã‚Š" },
            { majority: "å‹‡æ•¢ãªå­ç‹¼", minority: "åŠ›æŒã¡ã®å­ç‹¼" },
            { majority: "æ´»åŠ›ã®ãƒ‘ã‚ºãƒ«ãƒãƒƒã‚°", minority: "æ´»åŠ›ã®ã‚¢ãƒŸãƒ¥ãƒ¬ãƒƒãƒˆ" },
            { majority: "æœªé‘‘å®šã®ã‚¢ãƒŸãƒ¥ãƒ¬ãƒƒãƒˆ", minority: "æœªçŸ¥ã®ã‚¹ã‚­ãƒ«" },
            { majority: "è²¡å®ã®ç®±", minority: "å¯Œã®å®ç®±" },
            { majority: "ç‡ƒãˆã‚‹ãŸã„ã¾ã¤", minority: "é­”æ³•ã®ãŸã„ã¾ã¤" },
            { majority: "ã‚¦ã‚¤ãƒ³ã‚°ãƒ–ãƒ¼ãƒ„", minority: "çŸ³ã®ãƒ–ãƒ¼ãƒ„" },
            { majority: "ç‹ã®å† ", minority: "è¼ã‘ã‚‹ç‹å† " },
            { majority: "ã‚­ãƒ³ã‚°ãƒ»ã‚¹ãƒ©ãƒãƒ¼ãƒˆ", minority: "ãƒ›ãƒ¼ãƒªãƒ¼ã‚¹ãƒ”ã‚¢" },
            { majority: "çªãã‚­ãƒã®çŸ­å¼“", minority: "ãƒ•ã‚©ãƒ«ãƒˆã‚¥ãƒŠã®é¡˜ã„å¼“" }
];


        let selectedTheme = null;
        let wolfPositions = [];
        let discussionInterval = null;

        function startGame() {
            const players = parseInt(document.getElementById('players').value);
            const wolves = parseInt(document.getElementById('wolves').value);
            const myNumber = parseInt(document.getElementById('myNumber').value);

            if (myNumber < 1 || myNumber > players) {
                alert("æ­£ã—ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
                return;
            }

            document.getElementById('setup').classList.add('hidden');
            document.getElementById('guide').classList.remove('hidden');
            document.getElementById('timer').classList.remove('hidden');
            document.getElementById('revealBtn').classList.remove('hidden');

            const timerDiv = document.getElementById('timer');
            setInterval(() => {
                const now = new Date();
                timerDiv.textContent = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            }, 100);
        }

        function revealWord() {
            const players = parseInt(document.getElementById('players').value);
            const wolves = parseInt(document.getElementById('wolves').value);
            const myNumber = parseInt(document.getElementById('myNumber').value);

            const now = new Date().getTime();
            const tolerance = 2;
            const roundedTime = Math.floor(now / 1000 / tolerance) * tolerance * 1000;
            let seed = roundedTime + players * 100000 + wolves * 10000;

            function seededRandom() {
                seed = (seed * 16807) % 2147483647;
                return (seed - 1) / 2147483646;
            }

            const themeIndex = Math.floor(seededRandom() * themes.length);
            selectedTheme = themes[themeIndex];

            wolfPositions = [];
            while (wolfPositions.length < wolves) {
                const pos = Math.floor(seededRandom() * players) + 1;
                if (!wolfPositions.includes(pos)) wolfPositions.push(pos);
            }

            const resultDiv = document.getElementById('result');
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = '<img src="https://thumb.ac-illust.com/ca/ca19b1b823b60a02eeb8db837fd866db_t.jpeg" class="game-img" alt="ã‹ã‚ã„ã„ç‹¼"><br>';
            if (wolfPositions.includes(myNumber)) {
                resultDiv.innerHTML += `<strong style="color:blue; font-size:48px;">ç´›ã‚Œè¾¼ã‚“ã ç‹¼ã‚’ç‰¹å®šã›ã‚ˆï¼ğŸº</strong><br><br>ãŠé¡Œ: <strong style="font-size:42px;">${selectedTheme.minority}</strong>`;
            } else {
                resultDiv.innerHTML += `<strong style="color:blue; font-size:48px;">ç´›ã‚Œè¾¼ã‚“ã ç‹¼ã‚’ç‰¹å®šã›ã‚ˆï¼ğŸº</strong><br><br>ãŠé¡Œ: <strong style="font-size:42px;">${selectedTheme.majority}</strong>`;
            }
            resultDiv.innerHTML += `<br><br><small style="font-size:24px;">è­°è«–ã‚¹ã‚¿ãƒ¼ãƒˆï¼ğŸ•’</small>`;

            document.getElementById('revealBtn').classList.add('hidden');
            document.getElementById('timer').classList.add('hidden');
            document.getElementById('guide').classList.add('hidden');

            startDiscussionTimer();
            initVoteOptions();
        }

        function startDiscussionTimer() {
            document.getElementById('discussionTimer').classList.remove('hidden');
            let timeLeft = 180;
            const timerDiv = document.getElementById('discussionTimer');

            discussionInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDiv.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

                if (timeLeft <= 30) timerDiv.style.color = '#f00';
                if (timeLeft <= 10 && timeLeft > 0) {
                    document.getElementById('beepSound').play();
                }
                if (timeLeft <= 0) {
                    clearInterval(discussionInterval);
                    timerDiv.textContent = "æ™‚é–“çµ‚äº†ï¼æŠ•ç¥¨ã¸";
                    timerDiv.style.color = '#900';
                    document.getElementById('voteSection').classList.remove('hidden');
                    document.getElementById('resultSection').classList.remove('hidden');
                }
                timeLeft--;
            }, 1000);
        }

        function initVoteOptions() {
            const players = parseInt(document.getElementById('players').value);
            const select = document.getElementById('voteTarget');
            select.innerHTML = '';
            for (let i = 1; i <= players; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i}ç•ª`;
                select.appendChild(option);
            }
        }

        function submitVote() {
            const voteTarget = parseInt(document.getElementById('voteTarget').value);
            if (!voteTarget) {
                alert("æŠ•ç¥¨å…ˆã‚’é¸æŠã—ã¦ãã ã•ã„ï¼");
                return;
            }
            document.getElementById('myVote').innerHTML = `<strong style="font-size:28px;">ã‚ãªãŸã®æŠ•ç¥¨: ${voteTarget}ç•ª</strong>`;
            document.querySelector('#voteSection button').disabled = true;
        }

        function showFinalResult() {
            const banished = parseInt(document.getElementById('banished').value);
            if (!banished) {
                alert("è¿½æ”¾è€…ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
                return;
            }

            const resultDiv = document.getElementById('result');
            const isWolfBanished = wolfPositions.includes(banished);

            if (isWolfBanished) {
                resultDiv.innerHTML += `<br><img src="https://img.freepik.com/premium-photo/animated-victory-celebration-with-trophy-confetti-isolated-with-white-highlights_660230-185310.jpg" class="game-img" alt="å‹åˆ©ç¥è³€"><br><div class="win">ğŸ‰ å¤šæ•°æ´¾ï¼ˆå¸‚æ°‘ï¼‰ã®å‹åˆ©ï¼ ğŸ‰</div><br>`;
                resultDiv.innerHTML += `<strong style="font-size:36px;">è¿½æ”¾è€… ${banished}ç•ª ã¯ãƒ¯ãƒ¼ãƒ‰ã‚¦ãƒ«ãƒ•ã§ã—ãŸï¼</strong><br><br>`;
                document.getElementById('victorySound').play();
            } else {
                resultDiv.innerHTML += `<br><img src="https://media.tenor.com/nq6C5xO1W0gAAAAM/trombone-pusheen.gif" class="game-img" alt="ã‚µãƒƒãƒ‰ãƒˆãƒ­ãƒ³ãƒœãƒ¼ãƒ³"><br><div class="lose">ğŸ˜ˆ å°‘æ•°æ´¾ï¼ˆãƒ¯ãƒ¼ãƒ‰ã‚¦ãƒ«ãƒ•ï¼‰ã®å‹åˆ©ï¼ ğŸ˜ˆ</div><br>`;
                resultDiv.innerHTML += `<strong style="font-size:36px;">è¿½æ”¾è€… ${banished}ç•ª ã¯å¤šæ•°æ´¾ã§ã—ãŸ...</strong><br><br>`;
                document.getElementById('loseSound').play();
            }

            resultDiv.innerHTML += `<strong style="font-size:32px;">ãƒ¯ãƒ¼ãƒ‰ã‚¦ãƒ«ãƒ•ã¯ ${wolfPositions.join(', ')}ç•ª ã§ã—ãŸï¼</strong>`;

            document.getElementById('voteSection').classList.add('hidden');
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('discussionTimer').classList.add('hidden');

            document.getElementById('nextGameBtn').classList.remove('hidden');
        }

        function nextGame() {
            if (discussionInterval) clearInterval(discussionInterval);

            document.getElementById('result').classList.add('hidden');
            document.getElementById('result').innerHTML = '';
            document.getElementById('discussionTimer').classList.add('hidden');
            document.getElementById('voteSection').classList.add('hidden');
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('nextGameBtn').classList.add('hidden');
            document.getElementById('myVote').innerHTML = '';
            if (document.querySelector('#voteSection button')) {
                document.querySelector('#voteSection button').disabled = false;
            }

            document.getElementById('setup').classList.remove('hidden');
        }
    </script>
</body>
</html>

